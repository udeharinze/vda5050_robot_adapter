<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498DB"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27AE60"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#E67E22"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#F8F9FA"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1E3A5F">VDA 5050 System Architecture</text>
  
  <!-- FLEXUS MASTER CONTROL -->
  <g filter="url(#shadow)">
    <rect x="300" y="60" width="300" height="80" rx="10" fill="#1E3A5F"/>
    <text x="450" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">FLEXUS MASTER CONTROL</text>
    <text x="450" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#BDC3C7">Fleet Management &amp; Traffic Control</text>
    <text x="450" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#95A5A6">WebSocket Secure (WSS)</text>
  </g>
  
  <!-- Arrow: Flexus to Broker -->
  <line x1="450" y1="140" x2="450" y2="185" stroke="#3498DB" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="520" y="165" font-family="Arial, sans-serif" font-size="10" fill="#3498DB">order, instantActions</text>
  
  <!-- MQTT BROKER -->
  <g filter="url(#shadow)">
    <rect x="275" y="190" width="350" height="90" rx="10" fill="#3498DB"/>
    <text x="450" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">MQTT BROKER</text>
    <text x="450" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#E8F4F8">Message Router (Mosquitto / Flexus Cloud)</text>
    
    <!-- Ports -->
    <rect x="295" y="255" width="80" height="20" rx="3" fill="#2980B9"/>
    <text x="335" y="269" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">TCP :1883</text>
    
    <rect x="525" y="255" width="80" height="20" rx="3" fill="#2980B9"/>
    <text x="565" y="269" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">WSS :443</text>
  </g>
  
  <!-- Arrow: Broker to Backend -->
  <line x1="350" y1="280" x2="350" y2="325" stroke="#3498DB" stroke-width="3" marker-end="url(#arrowhead)"/>
  <text x="280" y="305" font-family="Arial, sans-serif" font-size="10" fill="#3498DB">order</text>
  
  <!-- Arrow: Backend to Broker (state) -->
  <line x1="380" y1="325" x2="380" y2="280" stroke="#27AE60" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <text x="395" y="305" font-family="Arial, sans-serif" font-size="10" fill="#27AE60">state</text>
  
  <!-- VDA 5050 BACKEND -->
  <g filter="url(#shadow)">
    <rect x="250" y="330" width="200" height="120" rx="10" fill="#27AE60"/>
    <text x="350" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">VDA 5050 BACKEND</text>
    <text x="350" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E8F8F0">vda_backend.py</text>
    
    <!-- Features list -->
    <text x="270" y="400" font-family="Arial, sans-serif" font-size="9" fill="#D5F5E3">• Order Processing</text>
    <text x="270" y="415" font-family="Arial, sans-serif" font-size="9" fill="#D5F5E3">• State Publishing (1s)</text>
    <text x="270" y="430" font-family="Arial, sans-serif" font-size="9" fill="#D5F5E3">• Base/Horizon Logic</text>
    <text x="270" y="445" font-family="Arial, sans-serif" font-size="9" fill="#D5F5E3">• Action Execution</text>
  </g>
  
  <!-- Arrow: Backend to Bridge -->
  <line x1="350" y1="450" x2="350" y2="495" stroke="#E67E22" stroke-width="3" marker-end="url(#arrowhead-orange)"/>
  <text x="280" y="475" font-family="Arial, sans-serif" font-size="10" fill="#E67E22">goTo, actions</text>
  
  <!-- Arrow: Bridge to Backend (position) -->
  <line x1="380" y1="495" x2="380" y2="450" stroke="#9B59B6" stroke-width="3"/>
  <polygon points="380,450 375,460 385,460" fill="#9B59B6"/>
  <text x="395" y="475" font-family="Arial, sans-serif" font-size="10" fill="#9B59B6">position, battery</text>
  
  <!-- BRIDGE -->
  <g filter="url(#shadow)">
    <rect x="250" y="500" width="200" height="90" rx="10" fill="#E67E22"/>
    <text x="350" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">BRIDGE</text>
    <text x="350" y="550" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FEF5E7">bridge_new.py</text>
    <text x="350" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FDEBD0">VDA 5050 ↔ Valetudo Translation</text>
    <text x="350" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FDEBD0">Position Polling (0.5s)</text>
  </g>
  
  <!-- Arrow: Bridge to Robot -->
  <line x1="350" y1="590" x2="350" y2="620" stroke="#E74C3C" stroke-width="3" marker-end="url(#arrowhead-orange)"/>
  <text x="280" y="610" font-family="Arial, sans-serif" font-size="10" fill="#E74C3C">HTTP API</text>
  
  <!-- ROBOT -->
  <g filter="url(#shadow)">
    <rect x="250" y="625" width="200" height="65" rx="10" fill="#E74C3C"/>
    <text x="350" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">DREAME ROBOT</text>
    <text x="350" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FADBD8">Valetudo Firmware • 192.168.178.69</text>
  </g>
  
  <!-- RIGHT SIDE: Message Flow Legend -->
  <g>
    <rect x="550" y="330" width="300" height="200" rx="10" fill="white" stroke="#BDC3C7" stroke-width="1"/>
    <text x="700" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A5F">Message Flow</text>
    
    <!-- Order flow -->
    <line x1="570" y1="380" x2="620" y2="380" stroke="#3498DB" stroke-width="3" marker-end="url(#arrowhead)"/>
    <text x="635" y="385" font-family="Arial, sans-serif" font-size="11" fill="#2C3E50">Order (Master → Robot)</text>
    
    <!-- State flow -->
    <line x1="570" y1="410" x2="620" y2="410" stroke="#27AE60" stroke-width="3" marker-end="url(#arrowhead-green)"/>
    <text x="635" y="415" font-family="Arial, sans-serif" font-size="11" fill="#2C3E50">State (Robot → Master)</text>
    
    <!-- Internal flow -->
    <line x1="570" y1="440" x2="620" y2="440" stroke="#E67E22" stroke-width="3" marker-end="url(#arrowhead-orange)"/>
    <text x="635" y="445" font-family="Arial, sans-serif" font-size="11" fill="#2C3E50">Internal Commands</text>
    
    <!-- Position flow -->
    <line x1="570" y1="470" x2="620" y2="470" stroke="#9B59B6" stroke-width="3"/>
    <polygon points="620,470 610,465 610,475" fill="#9B59B6"/>
    <text x="635" y="475" font-family="Arial, sans-serif" font-size="11" fill="#2C3E50">Position Updates</text>
    
    <!-- Protocols -->
    <text x="570" y="510" font-family="Arial, sans-serif" font-size="10" fill="#7F8C8D">Protocols: MQTT (JSON) • HTTP REST</text>
  </g>
  
  <!-- RIGHT SIDE: Topics Box -->
  <g>
    <rect x="550" y="545" width="300" height="130" rx="10" fill="white" stroke="#BDC3C7" stroke-width="1"/>
    <text x="700" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1E3A5F">MQTT Topics</text>
    
    <text x="570" y="595" font-family="Consolas, monospace" font-size="9" fill="#2C3E50">uagv/v2/Dreame/robot001/order</text>
    <text x="570" y="615" font-family="Consolas, monospace" font-size="9" fill="#2C3E50">uagv/v2/Dreame/robot001/instantActions</text>
    <text x="570" y="635" font-family="Consolas, monospace" font-size="9" fill="#2C3E50">uagv/v2/Dreame/robot001/state</text>
    <text x="570" y="655" font-family="Consolas, monospace" font-size="9" fill="#2C3E50">uagv/v2/Dreame/robot001/connection</text>
  </g>
  
  <!-- Left side annotation -->
  <g>
    <rect x="50" y="200" width="180" height="80" rx="8" fill="#ECF0F1" stroke="#BDC3C7"/>
    <text x="140" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1E3A5F">Flexus Cloud Broker</text>
    <text x="140" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7F8C8D">SAP Cloud Platform</text>
    <text x="140" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7F8C8D">WSS Port 443</text>
    <text x="140" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7F8C8D">WebSocket Secure</text>
  </g>
  <line x1="230" y1="235" x2="275" y2="235" stroke="#95A5A6" stroke-width="1" stroke-dasharray="5,3"/>
  
  <!-- Left side: Your System box -->
  <g>
    <rect x="50" y="370" width="180" height="250" rx="8" fill="#E8F6F3" stroke="#1ABC9C" stroke-width="2" stroke-dasharray="8,4"/>
    <text x="140" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1ABC9C">YOUR SYSTEM</text>
    <text x="140" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#16A085">(Runs on local computer)</text>
    
    <text x="70" y="445" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">✓ vda_backend.py</text>
    <text x="70" y="465" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">✓ bridge_new.py</text>
    <text x="70" y="485" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">✓ vda_config.py</text>
    <text x="70" y="505" font-family="Arial, sans-serif" font-size="10" fill="#2C3E50">✓ actions_basic.py</text>
    
    <line x1="70" y1="520" x2="210" y2="520" stroke="#1ABC9C" stroke-width="1"/>
    
    <text x="70" y="545" font-family="Arial, sans-serif" font-size="9" fill="#7F8C8D">Language: Python 3</text>
    <text x="70" y="560" font-family="Arial, sans-serif" font-size="9" fill="#7F8C8D">MQTT: Paho Client</text>
    <text x="70" y="575" font-family="Arial, sans-serif" font-size="9" fill="#7F8C8D">HTTP: Requests</text>
    <text x="70" y="590" font-family="Arial, sans-serif" font-size="9" fill="#7F8C8D">GUI: Tkinter</text>
  </g>
  
</svg>
