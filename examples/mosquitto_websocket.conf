# ============================================================================
# Mosquitto MQTT Broker Configuration with WebSocket Support
# ============================================================================
# 
# File: mosquitto.conf
# Location: /etc/mosquitto/mosquitto.conf (Linux) or C:\mosquitto\mosquitto.conf (Windows)
#
# This configuration enables:
#   - Standard MQTT on port 1883 (for your backend/bridge)
#   - WebSocket MQTT on port 9001 (for Flexus Master Control)
#
# ============================================================================

# ----------------------------------------------------------------------------
# General Settings
# ----------------------------------------------------------------------------

# Allow anonymous connections (for testing)
# For production, set to false and configure authentication
allow_anonymous true

# Persistence (save messages to disk)
persistence true
persistence_location /var/lib/mosquitto/

# Logging
log_dest file /var/log/mosquitto/mosquitto.log
log_type all

# ----------------------------------------------------------------------------
# Listener 1: Standard MQTT (TCP) - Port 1883
# ----------------------------------------------------------------------------
# Used by: vda_backend.py, bridge_new.py, MQTTX

listener 1883
protocol mqtt

# ----------------------------------------------------------------------------
# Listener 2: MQTT over WebSocket - Port 9001
# ----------------------------------------------------------------------------
# Used by: Flexus Master Control (web-based)

listener 9001
protocol websockets

# Optional: Allow connections from any IP (for network access)
# socket_domain ipv4


# ============================================================================
# INSTALLATION INSTRUCTIONS
# ============================================================================
#
# --- LINUX (Ubuntu/Debian) ---
#
# 1. Install Mosquitto:
#    sudo apt update
#    sudo apt install mosquitto mosquitto-clients
#
# 2. Backup original config:
#    sudo cp /etc/mosquitto/mosquitto.conf /etc/mosquitto/mosquitto.conf.backup
#
# 3. Edit config:
#    sudo nano /etc/mosquitto/mosquitto.conf
#    (paste the configuration above)
#
# 4. Restart Mosquitto:
#    sudo systemctl restart mosquitto
#
# 5. Check status:
#    sudo systemctl status mosquitto
#
# 6. Test WebSocket (optional):
#    sudo apt install wscat  # or: npm install -g wscat
#    wscat -c ws://localhost:9001
#
#
# --- WINDOWS ---
#
# 1. Download Mosquitto from: https://mosquitto.org/download/
#
# 2. Edit C:\mosquitto\mosquitto.conf with the configuration above
#
# 3. Restart Mosquitto service:
#    net stop mosquitto
#    net start mosquitto
#
#
# --- DOCKER ---
#
# docker run -it -p 1883:1883 -p 9001:9001 \
#   -v $(pwd)/mosquitto.conf:/mosquitto/config/mosquitto.conf \
#   eclipse-mosquitto
#
#
# ============================================================================
# FIREWALL RULES (if needed)
# ============================================================================
#
# Linux (ufw):
#   sudo ufw allow 1883/tcp
#   sudo ufw allow 9001/tcp
#
# Windows:
#   netsh advfirewall firewall add rule name="MQTT" dir=in action=allow protocol=tcp localport=1883
#   netsh advfirewall firewall add rule name="MQTT-WS" dir=in action=allow protocol=tcp localport=9001
#
# ============================================================================
